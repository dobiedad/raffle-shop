<section class="section user-profile" style="background-color:#f8f9fb; min-height:100vh;">
  <div class="container">

    <div class="box has-text-centered" style="padding:3rem 2rem; border-radius:14px;">
      <div class="mb-3" style="display: inline-block;">
        <%= image_tag helpers.user_avatar_url(user), alt: "Profile photo", class: "profile-image" %>
      </div>

      <h1 class="title is-4 mb-1"><%= user.email %></h1>
      <p class="is-size-7 has-text-grey mb-2">
        Member since <strong><%= user.created_at.strftime("%B %Y") %></strong>
      </p>

      <div class="tags is-centered mb-4">
        <span class="tag is-light is-info">Verified</span>
        <span class="tag is-light is-success">Active</span>
      </div>

      <%= helpers.turbo_frame_tag "user-profile-actions-#{user.id}" do %>
        <div class="is-flex is-justify-content-center is-align-items-center mb-4" style="gap: 1rem;">
          <%= link_to helpers.followers_user_path(user), class: "has-text-centered", data: { turbo: false } do %>
            <p class="has-text-weight-semibold" id="followers-count-<%= user.id %>"><%= user.followers.count %></p>
            <p class="is-size-7 has-text-grey">Followers</p>
          <% end %>
          <%= link_to helpers.following_user_path(user), class: "has-text-centered", data: { turbo: false } do %>
            <p class="has-text-weight-semibold" id="following-count-<%= user.id %>"><%= user.followings.count %></p>
            <p class="is-size-7 has-text-grey">Following</p>
          <% end %>
        </div>

        <div class="buttons is-centered">
          <% if own_profile? %>
            <% action_buttons.each do |button| %>
              <%= link_to button[:label], button[:path], class: "button #{button[:class]} is-small", data: { turbo: false } %>
            <% end %>
          <% else %>
            <%= link_to "View Raffles", helpers.raffles_user_path(user), class: "button is-primary is-small", data: { turbo: false } %>
            <%= helpers.follow_button_for(user, size: 'is-small') %>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="columns is-multiline mt-6">

      <div class="column is-one-third">
        <div class="box has-text-centered" style="border-radius:12px;">
          <h2 class="title is-6 mb-3">üéüÔ∏è Tickets Entered</h2>
          <p class="is-size-3 has-text-weight-semibold"><%= tickets_entered_count %></p>
        </div>
      </div>

      <div class="column is-one-third">
        <div class="box has-text-centered" style="border-radius:12px;">
          <h2 class="title is-6 mb-3">üí∞ Total Spent</h2>
          <p class="is-size-3 has-text-weight-semibold"><%= helpers.format_currency(total_spent) %></p>
        </div>
      </div>

      <div class="column is-one-third">
        <div class="box has-text-centered" style="border-radius:12px;">
          <h2 class="title is-6 mb-3">üèÜ Raffles Won</h2>
          <p class="is-size-3 has-text-weight-semibold"><%= raffles_won_count %></p>
        </div>
      </div>

      <% if show_wallet? %>
        <div class="column is-half">
          <div class="box" style="border-radius:12px;">
            <div class="is-flex is-justify-content-space-between is-align-items-center">
              <div>
                <h2 class="title is-6 mb-2">Wallet Balance</h2>
                <p class="is-size-4 has-text-weight-semibold"><%= helpers.format_currency(wallet_balance) %></p>
              </div>
              <div class="buttons">
                <%= link_to "Add Funds", "#", class: "button is-primary is-small", onclick: "alert('Add funds feature coming soon!'); return false;" %>
                <%= link_to "Withdraw", "#", class: "button is-light is-small", onclick: "alert('Withdraw feature coming soon!'); return false;" %>
              </div>
            </div>
          </div>
        </div>
      <% end %>

      <div class="column <%= show_wallet? ? 'is-half' : 'is-half' %>">
        <div class="box" style="border-radius:12px;">
          <h2 class="title is-6 mb-3">Achievements</h2>
          <div class="tags">
            <%= helpers.render_achievements(user) %>
          </div>
        </div>
      </div>

      <div class="column is-full">
        <div class="box" style="border-radius:12px;">
          <h2 class="title is-6 mb-4">Recent Activity</h2>

          <% if recent_activities.present? %>
            <table class="table is-fullwidth is-hoverable is-size-7">
              <tbody>
                <% recent_activities.each do |activity| %>
                  <tr>
                    <td><%= activity[:description] %></td>
                    <td class="has-text-right has-text-grey"><%= activity[:time_ago] %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
            <% if show_activity_link? %>
              <%= link_to "View Full History ‚Üí", helpers.wallet_path, class: "has-text-link is-size-7" %>
            <% end %>
          <% else %>
            <%= helpers.render UI::EmptyState.new(
              title: 'No recent activity',
              description: recent_activity_empty_message
            ) %>
          <% end %>
        </div>
      </div>

    </div>
  </div>
</section>
