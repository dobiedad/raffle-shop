<section class="section user-profile" style="background-color:#f8f9fb; min-height:100vh;">
  <div class="container">
    <div class="columns is-variable is-6">
      <div class="column is-12-tablet is-4-desktop">
        <div class="box has-text-centered" style="padding:2.25rem 1.75rem; border-radius:14px;">
          <div class="mb-3" style="display:inline-block;">
            <%= image_tag helpers.user_avatar_url(user), alt: "Profile photo", class: "profile-image" %>
          </div>

          <h1 class="title is-4 mb-1"><%= user.full_name %></h1>
          <p class="is-size-7 has-text-grey mb-2">Member since <strong><%= user.created_at.strftime("%B %Y") %></strong></p>

          <div class="tags is-centered mb-3">
            <span class="tag is-light is-info">Verified</span>
            <span class="tag is-light is-success">Active</span>
          </div>

          <%= helpers.turbo_frame_tag "user-profile-actions-#{user.id}" do %>
            <div class="is-flex is-justify-content-center is-align-items-center mb-3" style="gap: 1.25rem;">
              <%= link_to helpers.followers_user_path(user), class: "has-text-centered", data: { turbo: false } do %>
                <p class="has-text-weight-semibold" id="followers-count-<%= user.id %>"><%= user.followers.count %></p>
                <p class="is-size-7 has-text-grey">Followers</p>
              <% end %>
              <%= link_to helpers.following_user_path(user), class: "has-text-centered", data: { turbo: false } do %>
                <p class="has-text-weight-semibold" id="following-count-<%= user.id %>"><%= user.followings.count %></p>
                <p class="is-size-7 has-text-grey">Following</p>
              <% end %>
            </div>

            <div class="buttons is-centered">
              <% if own_profile? %>
                <% action_buttons.each do |button| %>
                  <%= link_to button[:label], button[:path], class: "button #{button[:class]} is-small", data: { turbo: false } %>
                <% end %>
              <% else %>
                <%= link_to "View Raffles", helpers.raffles_user_path(user), class: "button is-primary is-small", data: { turbo: false } %>
                <%= helpers.follow_button_for(user, size: 'is-small') %>
              <% end %>
            </div>
          <% end %>
        </div>

        <% if show_wallet? %>
          <div class="box" style="border-radius:12px; margin-top:1.25rem;">
            <div class="is-flex is-justify-content-space-between is-align-items-center">
              <div>
                <h2 class="title is-6 mb-2">Wallet Balance</h2>
                <p class="is-size-4 has-text-weight-semibold"><%= helpers.format_currency(wallet_balance) %></p>
              </div>
              <div class="buttons">
                <%= link_to "View", wallet_path, class: "button is-light is-small" %>
              </div>
            </div>
          </div>
        <% end %>


        <div class="box" style="border-radius:12px; margin-top:1.25rem;">
          <h2 class="title is-6 mb-3">Achievements</h2>
          <div class="tags">
            <%= helpers.render_achievements(user) %>
          </div>
        </div>
      </div>

      <div class="column is-12-tablet is-8-desktop">
        <div class="columns is-multiline">
          <div class="column is-half">
            <div class="box has-text-centered metric">
              <h2 class="title is-6 mb-2">🎟️ Tickets Entered</h2>
              <p class="is-size-3 has-text-weight-semibold"><%= tickets_entered_count %></p>
            </div>
          </div>
          <div class="column is-half">
            <div class="box has-text-centered metric">
              <h2 class="title is-6 mb-2">💰 Total Spent</h2>
              <p class="is-size-3 has-text-weight-semibold"><%= helpers.format_currency(total_spent) %></p>
            </div>
          </div>
          <div class="column is-half">
            <div class="box has-text-centered metric">
              <h2 class="title is-6 mb-2">🏆 Raffles Won</h2>
              <p class="is-size-3 has-text-weight-semibold"><%= raffles_won_count %></p>
            </div>
          </div>
          <div class="column is-half">
            <div class="box has-text-centered metric">
              <h2 class="title is-6 mb-2">📈 Win Rate</h2>
              <p class="is-size-3 has-text-weight-semibold"><%= win_rate_percent %>%</p>
            </div>
          </div>
        </div>

        <div class="box" style="border-radius:12px;">
          <h2 class="title is-6 mb-4">Recent Activity</h2>

          <% if recent_activities.present? %>
            <table class="table is-fullwidth is-hoverable is-size-7">
              <tbody>
                <% recent_activities.each do |activity| %>
                  <tr>
                    <td><%= activity[:description] %></td>
                    <td class="has-text-right has-text-grey"><%= activity[:time_ago] %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
            <% if show_activity_link? %>
              <%= link_to "View Full History →", helpers.wallet_path, class: "has-text-link is-size-7" %>
            <% end %>
          <% else %>
            <%= helpers.render UI::EmptyState.new(
              title: 'No recent activity',
              description: recent_activity_empty_message
            ) %>
          <% end %>
        </div>
      </div>
    </div>
    <% if own_profile? %>
      <div class="box" style="border-radius:12px; margin-bottom:2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2rem; color: white;">
        <div class="columns is-variable is-6 is-align-items-center">
          <div class="column is-8">
            <div class="is-flex is-align-items-center mb-3">
              <span class="icon is-large mr-3" style="font-size: 2.5rem;">🎁</span>
              <div>
                <h2 class="title is-4 mb-1 has-text-white">Share & Earn Rewards</h2>
                <p class="is-size-6 has-text-white-ter">Invite friends and get rewarded when they join!</p>
              </div>
            </div>

             <div class="is-flex is-align-items-center is-flex-wrap-wrap" style="background: rgba(255,255,255,0.25); border-radius: 10px; padding: 1rem;">
               <div class="is-flex-grow-1 mr-3" style="min-width: 200px;">
                 <p class="is-size-7 has-text-white-ter mb-1">Your Referral Code</p>
                 <code class="has-text-white" style="font-size: 1.5rem; font-weight: 700; letter-spacing: 2px; background: transparent;"><%= user.referral_code %></code>
               </div>
               <button class="button"
                       data-controller="copy"
                       data-copy-text-value="<%= helpers.request.base_url %>/users/sign_up?referrer_code=<%= user.referral_code %>"
                       data-action="click->copy#copy"
                       style="background: white; color: #667eea; font-weight: 600; border: none; border-radius: 8px; padding: 0.75rem 1.5rem; flex-shrink: 0;">
                 📋 Copy Link
               </button>
             </div>
             <div class="mt-4">
               <%= link_to "View Referrals & Rewards →", referrals_path, class: "button is-white is-outlined", style: "border-color: white; color: white; font-weight: 600;" %>
             </div>
          </div>

          <div class="column is-4">
            <div class="has-text-centered" style="background: rgba(255,255,255,0.15); border-radius: 10px; padding: 1.5rem;">
              <p class="is-size-6 has-text-white-ter mb-2">Total Referrals</p>
              <p class="is-size-1 has-text-white has-text-weight-bold" style="font-size: 3rem !important;"><%= user.referred_users.count %></p>
              <% if user.referred_by.present? %>
                <p class="is-size-7 has-text-white-ter mt-2">Referred by <strong><%= user.referred_by.full_name %></strong></p>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</section>
