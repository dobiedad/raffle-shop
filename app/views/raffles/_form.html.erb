<%= form_with(model: raffle, local: true) do |form| %>
  <% if raffle.errors.any? %>
    <div class="notification is-danger">
      <strong><%= pluralize(raffle.errors.count, "error") %> prevented saving:</strong>
      <ul>
        <% raffle.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- NAME -->
  <div class="field mb-5">
    <%= form.label :name, "Raffle Name", class: "label has-text-weight-medium" %>
    <%= form.text_field :name, 
        class: "input is-medium", 
        placeholder: "e.g. PlayStation 5 Slim + Extra Controller",
        data: { 
          raffle_preview_target: "name",
          action: "input->raffle-preview#updateName"
        } %>
  </div>

  <!-- PRICING -->
  <div class="columns mb-5">
    <div class="column">
      <div class="field">
        <%= form.label :price, "Price Target", class: "label has-text-weight-medium" %>
        <%= form.number_field :price, class: "input is-medium", step: 0.01, placeholder: "550.00" %>
        <p class="help">Total value you want to reach</p>
      </div>
    </div>
    <div class="column">
      <div class="field">
        <%= form.label :ticket_price, "Ticket Price", class: "label has-text-weight-medium" %>
        <%= form.number_field :ticket_price, 
            class: "input is-medium", 
            step: 0.01, 
            placeholder: "3.50",
            data: { 
              raffle_preview_target: "ticketPrice",
              action: "input->raffle-preview#updateTicketPrice"
            } %>
        <p class="help">Price per entry</p>
      </div>
    </div>
  </div>

  <!-- CATEGORY -->
  <div class="columns mb-5">
    <div class="column">
      <div class="field">
        <%= form.label :category, "Category", class: "label has-text-weight-medium" %>
        <div class="control">
          <div class="select is-medium is-fullwidth">
            <%= form.select :category,
                options_for_select(['Tech', 'Gaming', 'Fashion', 'Home', 'Vehicles', 'Other'], raffle.category),
                { prompt: 'Select a category' },
                class: "select is-medium" %>
          </div>
        </div>
      </div>
    </div>
    <div class="column">
      <div class="field">
        <%= form.label :condition, "Condition", class: "label has-text-weight-medium" %>
        <div class="control">
          <div class="select is-medium is-fullwidth">
            <%= form.select :condition,
                options_for_select(['New', 'Like New', 'Good', 'Fair'], raffle.condition),
                { prompt: 'Select condition' },
                class: "select is-medium" %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DESCRIPTION -->
  <div class="field mb-6">
    <%= form.label :description, "Description", class: "label has-text-weight-medium" %>
    <p class="help mb-2">Describe your item, its condition, and what's included.</p>
    <%= form.rich_text_area :description, 
        placeholder: "Describe your raffle in detail...",
        data: { 
          raffle_preview_target: "description",
          action: "trix-change->raffle-preview#updateDescription"
        } %>
  </div>

  <!-- IMAGES -->
  <div class="field mt-6" data-controller="image-upload">
    <%= form.label :images, "Images", class: "label has-text-weight-medium" %>
    <p class="help mb-3">Upload clear product photos (up to 10).</p>
    <div class="image-upload-container"
         data-image-upload-target="dropzone"
         data-action="dragover->image-upload#dragOver dragleave->image-upload#dragLeave drop->image-upload#drop click->image-upload#openFileDialog">
      <div class="upload-placeholder">
        <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
        </svg>
        <p class="upload-text">Click or drag & drop to upload images</p>
        <p class="upload-hint">JPEG, PNG, GIF, WebP • Max 10MB • Up to 10 images</p>
      </div>
      <%= form.file_field :images, multiple: true, accept: "image/*", direct_upload: true,
          class: "hidden-file-input",
          data: { 
            image_upload_target: "input",
            raffle_preview_target: "image",
            action: "change->image-upload#handleFiles change->raffle-preview#updateImage"
          } %>
    </div>
    <div class="image-previews" data-image-upload-target="previews"></div>
  </div>

  <div class="columns mb-5">
    <div class="column">
      <div class="field">
        <%= form.label :end_date, "End Date", class: "label has-text-weight-medium" %>
        <%= form.datetime_field :end_date, class: "input is-medium" %>
        <p class="help">When the raffle closes</p>
      </div>
    </div>
    <div class="column">
    </div>
  </div>

  <hr class="my-6">

  <!-- BUTTONS -->
  <div class="is-flex is-justify-content-space-between">
    <%= link_to "Cancel", raffles_path, class: "button is-light" %>
    <%= form.submit "Create Raffle", class: "button is-primary is-medium" %>
  </div>
<% end %>
