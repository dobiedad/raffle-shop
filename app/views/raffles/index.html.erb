<!-- Top Notification Banner -->
<%= render UI::NotificationBanner.new(
  type: 'info',
  icon: 'üí°',
  title: 'Tip:',
  message: 'Buying multiple tickets increases your odds ‚Äî view active raffles below.'
) %>

<div class="section raffles-index" style="background-color: #f9fafb;">
  <div class="container is-max-widescreen">

    <%= render UI::PageHeader.new(
      title: 'üéüÔ∏è Current Raffles',
      subtitle: 'Enter raffles for the latest gadgets, collectibles, and more ‚Äî starting from just $1 per ticket.'
    ) %>

    <%= render UI::SearchBar.new(
      value: params.dig(:q, :name_cont),
      url: raffles_path,
      param_name: 'q[name_cont]',
      placeholder: 'Search raffles (e.g. iPhone, PS5, sneakers)',
      preserve_params: ['category']
    ) %>

    <div class="buttons are-small is-centered mb-6">
      <%= link_to 'All', raffles_path(params.permit(:q, :category).except(:category)),
          class: "button is-light u-borderRadius50 #{'is-active' if @active_category == 'All'}" %>
      <% Raffle::CATEGORIES.each do |category| %>
        <%= link_to category.humanize, raffles_path(params.permit(:q, :category).merge(category: category)),
            class: "button is-light u-borderRadius50 #{'is-active' if @active_category == category}" %>
      <% end %>
    </div>

    <% if @raffles.present? %>
      <div class="columns is-multiline">
        <% @raffles.each do |raffle| %>
          <div class="column is-one-third-desktop is-half-tablet">
            <%= render UI::RaffleCard.new(raffle: raffle) %>
          </div>
        <% end %>
      </div>
    <% else %>
      <%= render UI::EmptyState.new(
        title: 'No raffles available right now',
        description: 'Check back soon ‚Äî new items are added daily.',
        action: user_signed_in? ? link_to("Create one now", new_raffle_path, class: "button is-primary u-borderRadius50").html_safe : nil
      ) %>
    <% end %>

    <% if @raffles.present? %>
      <p class="has-text-centered is-size-6 has-text-grey mt-5">
        Over <strong><%= @total_raffles_count %></strong> active raffles ¬∑ <strong>2,300</strong> tickets sold today
      </p>
    <% end %>

    <div class="has-text-centered mt-5 mb-4">
      <%= link_to completed_raffles_path, class: "button is-light u-borderRadius50" do %>
        <span class="icon">
          <span>üèÅ</span>
        </span>
        <span>View Completed Raffles</span>
      <% end %>
    </div>

    <%= render UI::Pagination.new(pagy: @pagy) %>

    <% if @raffles.present? %>
      <p class="has-text-centered is-size-7 has-text-grey mt-2">
        Showing <%= @pagy.from %>‚Äì<%= @pagy.to %> of <%= @pagy.count %> raffles
      </p>
    <% end %>

    <div class="has-text-centered mt-6">
      <p class="is-size-7 has-text-grey">
        Platform total: <strong>$12,430 raised</strong> ¬∑ <strong>5,300 tickets</strong> sold across all raffles
      </p>
    </div>

    <% if user_signed_in? %>
      <%= link_to new_raffle_path,
          class: 'button is-primary is-medium',
          'aria-label': 'New Raffle',
          title: 'New Raffle',
          style: 'position: fixed; bottom: 2rem; right: 2rem; border-radius: 50%; width: 60px; height: 60px; padding: 0; font-size: 2rem; line-height: 60px;' do %>
        +
      <% end %>
    <% end %>

  </div>
</div>

<style>
  .button.is-primary:hover { filter: brightness(1.1); }

  .raffle-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  }

  .button.u-borderRadius50.is-active {
    background-color: #4f46e5;
    color: #fff;
    font-weight: 600;
  }


  .raffle-card {
    opacity: 0;
    transform: translateY(10px);
    animation: fadeUp 1s ease forwards;
  }

  @keyframes fadeUp {
    to { opacity: 1; transform: translateY(0); }
  }
</style>
