<!-- Top Notification Banner -->
<%= render UI::NotificationBanner.new(
  type: 'info',
  icon: 'üí°',
  title: 'Tip:',
  message: 'Buying multiple tickets increases your odds ‚Äî view active raffles below.'
) %>

<div class="section raffles-index" style="background-color: #f9fafb;">
  <div class="container">

    <!-- Hero Header -->
    <div class="has-text-centered mb-6">
      <h1 class="title is-2 mb-6">üéüÔ∏è Current Raffles</h1>
      <p class="subtitle is-5 has-text-grey">
        Enter raffles for the latest gadgets, collectibles, and more ‚Äî starting from just $1 per ticket.
      </p>
    </div>

    <!-- Search Bar -->
    <%= search_form_for @q, html: { class: 'field has-addons has-addons-centered mb-6', style: 'margin: 0 auto;' } do |f| %>
      <div class="control is-expanded">
        <%= f.search_field :name_cont, 
            class: 'input is-medium', 
            placeholder: 'Search raffles (e.g. iPhone, PS5, sneakers)',
            value: params.dig(:q, :name_cont) %>
      </div>
      <div class="control">
        <%= f.submit 'Search', class: 'button is-medium is-primary', style: 'font-weight:600;' %>
      </div>
    <% end %>

    <!-- Category Filter Bar -->
    <div class="buttons are-small is-centered mb-6">
      <%= link_to 'All', raffles_path, 
          class: "button is-light is-rounded #{'is-active' if @active_category == 'All'}" %>
      <%= link_to 'Tech', raffles_path(category: 'Tech'), 
          class: "button is-light is-rounded #{'is-active' if @active_category == 'Tech'}" %>
      <%= link_to 'Gaming', raffles_path(category: 'Gaming'), 
          class: "button is-light is-rounded #{'is-active' if @active_category == 'Gaming'}" %>
      <%= link_to 'Fashion', raffles_path(category: 'Fashion'), 
          class: "button is-light is-rounded #{'is-active' if @active_category == 'Fashion'}" %>
      <%= link_to 'Home', raffles_path(category: 'Home'), 
          class: "button is-light is-rounded #{'is-active' if @active_category == 'Home'}" %>
    </div>

    <!-- Raffle Grid -->
    <% if @raffles.present? %>
      <div class="columns is-multiline">
        <% @raffles.each do |raffle| %>
          <div class="column is-one-third-desktop is-half-tablet">
            <%= render UI::RaffleCard.new(raffle: raffle) %>
          </div>
        <% end %>
      </div>
    <% else %>
      <!-- Empty State -->
      <div class="has-text-centered py-6">
        <p class="is-size-5 has-text-grey-dark mb-2">No raffles available right now</p>
        <p class="is-size-6 has-text-grey">Check back soon ‚Äî new items are added daily.</p>
        <% if user_signed_in? %>
          <%= link_to "Create one now", new_raffle_path, class: "button is-primary is-rounded mt-4" %>
        <% end %>
      </div>
    <% end %>

    <!-- Statistics Above Pagination -->
    <% if @raffles.present? %>
      <p class="has-text-centered is-size-6 has-text-grey mt-5">
        Over <strong><%= @total_raffles_count %></strong> active raffles ¬∑ <strong>2,300</strong> tickets sold today
      </p>
    <% end %>

    <!-- Pagination -->
    <% if @pagy.pages > 1 %>
      <%= pagy_bulma_nav(@pagy) %>
    <% end %>

    <!-- Pagination Info -->
    <% if @raffles.present? %>
      <p class="has-text-centered is-size-7 has-text-grey mt-2">
        Showing <%= @pagy.from %>‚Äì<%= @pagy.to %> of <%= @pagy.count %> raffles
      </p>
    <% end %>

    <!-- Platform Statistics -->
    <div class="has-text-centered mt-6">
      <p class="is-size-7 has-text-grey">
        Platform total: <strong>$12,430 raised</strong> ¬∑ <strong>5,300 tickets</strong> sold across all raffles
      </p>
    </div>

    <!-- Floating Action Button -->
    <% if user_signed_in? %>
      <%= link_to new_raffle_path, 
          class: 'button is-primary is-medium',
          style: 'position: fixed; bottom: 2rem; right: 2rem; border-radius: 50%; width: 60px; height: 60px; padding: 0; font-size: 2rem; line-height: 60px;' do %>
        +
      <% end %>
    <% end %>

  </div>
</div>

<style>
  .button.is-primary:hover { filter: brightness(1.1); }
  
  .raffle-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  }
  
  .button.is-rounded.is-active {
    background-color: #4f46e5;
    color: #fff;
    font-weight: 600;
  }
  
  .input.is-medium {
    border-radius: 9999px;
    border-color: #e5e7eb;
    box-shadow: 0 1px 3px rgba(0,0,0,0.03);
  }

  .input.is-medium:focus {
    border-color: #4f46e5;
    box-shadow: 0 0 0 0.2em rgba(79,70,229,0.15);
  }

  .button.is-primary {
    border-radius: 9999px;
    background-color: #4f46e5;
    font-weight: 600;
    transition: all 0.2s ease;
  }

  .button.is-primary:hover {
    background-color: #4338ca;
  }

  .pagination a,
  .pagination span {
    border-radius: 8px;
  }

  .pagination-link.is-current {
    background-color: #4f46e5;
    border-color: #4f46e5;
    color: #fff;
    font-weight: 600;
  }

  .pagination-link:hover {
    border-color: #4f46e5;
    color: #4f46e5;
  }

  .raffle-card {
    opacity: 0;
    transform: translateY(10px);
    animation: fadeUp 1s ease forwards;
  }
  
  @keyframes fadeUp {
    to { opacity: 1; transform: translateY(0); }
  }
</style>
